<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>문자 전송</title>

  <!-- css -->
  <link rel="stylesheet" href="../assets/scss/common/jquery.mCustomScrollbar.min.css">
  <link rel="stylesheet" href="../assets/scss/adm/admin.css">

  <!-- js :: lib -->
  <script type="text/javascript" src="../assets/js/lib/jquery-1.12.4.js"></script>
  <script type="text/javascript" src="../assets/js/lib/jquery-ui.min.js"></script>
  <script type="text/javascript" src="../assets/js/lib/jquery.modal.min.js"></script>
  <script type="text/javascript" src="../assets/js/lib/jquery.selectric.js"></script>
  <script type="text/javascript" src="../assets/js/lib/jquery.mCustomScrollbar.concat.min.js"></script>

  <!-- js :: common -->
  <script type="text/javascript" src="../assets/js/adm/admin.js"></script>
</head>


<!-- 1. type-red, type-orange, type-yellow ... 등 클래스 추가 시 배경 색상 변경 -->
<!-- 2. 관리자 페이지 admin 클래스 추가 -->

 <body class="admin">
  <div class="popup-admin">
    <div class="popup-header">
      <h2 class="popup-title">문자 전송</h2>
    </div>
    <!-- e: popup-header -->
    <div class="popup-content">
      <iframe
        src="./partial-send.html"
        frameborder="0" width="100%" height="1030px"
        id="innerIframe"
      ></iframe>
      
    </div>
  </div>
</body>
</html>




  <script>

function resizeParentIframe() {
        const height = document.documentElement.scrollHeight;
        window.parent.postMessage({ type: 'resize-iframe', height }, '*');
      }

      window.addEventListener('load', resizeParentIframe);
      window.addEventListener('resize', resizeParentIframe); // 내부 리사이즈 대응

      document.addEventListener('DOMContentLoaded', () => {
        initSettingMenu();
        initMessageByteCount();
        initMobileTabToggle();
        initSpecialCharButton();
        initSendCheckboxToggle();
      });

      // 관리메뉴 클릭 이벤트
      function initSettingMenu() {
        const menus = document.querySelectorAll('.setting-menu');
        menus.forEach(menu => {
          const btn = menu.querySelector('.btn-setting');
          const dropdown = menu.querySelector('.setting-drop');
          btn.addEventListener('click', e => {
            e.stopPropagation();
            menus.forEach(m => m.querySelector('.setting-drop').classList.remove('active'));
            dropdown.classList.toggle('active');
          });
        });
        document.addEventListener('click', () => {
          document.querySelectorAll('.setting-drop.active').forEach(drop => drop.classList.remove('active'));
        });
      }

      // 문자메시지 byte 
      function initMessageByteCount() {
        document.querySelectorAll('.message-box__cont').forEach(box => {
          const textarea = box.querySelector('textarea');
          const byteCount = box.querySelector('.byte-count b');
          if (!textarea || !byteCount) return;
          const updateByteCount = () => {
            const text = textarea.value;
            const bytes = [...text].reduce((acc, ch) => acc + (ch.charCodeAt(0) > 0x7f ? 2 : 1), 0);
            byteCount.textContent = `${bytes}`;
          };
          textarea.addEventListener('input', updateByteCount);
          updateByteCount();
        });
      }

      // 모바일에서 탭 메뉴 열고 닫기
      function initMobileTabToggle() {
        document.querySelectorAll('.tab-menu__control').forEach(menu => {
          menu.addEventListener('click', () => {
            const cont = menu.nextElementSibling;
            cont.classList.toggle('open');
            menu.classList.toggle('active');
            resizeParentIframe();

          });
        });
      }


      // 특수문자 팝업
      function initSpecialCharButton() {
        document.querySelectorAll('.btn-special').forEach(button => {
          button.addEventListener('click', (e) => {
            e.stopPropagation();

            // 모든 팝업 닫기
            document.querySelectorAll('.char-popup').forEach(popup => popup.style.display = 'none');

            // 현재 버튼의 부모에서 가장 가까운 char-popup만 열기
            const popup = button.closest('.message-box__tit')?.querySelector('.char-popup') ||
                          button.closest('.template-item')?.querySelector('.char-popup');
            if (popup) popup.style.display = 'block';
          });
        });

        // 외부 클릭 시 모든 char-popup 닫기
        document.addEventListener('click', e => {
          if (!e.target.closest('.char-popup') && !e.target.classList.contains('btn-special')) {
            document.querySelectorAll('.char-popup').forEach(popup => popup.style.display = 'none');
          }
        });
      }

      function closeCharPopup() {
        document.querySelectorAll('.char-popup').forEach(popup => popup.style.display = 'none');
      }


      // 이동
      function moveToTab(tabIndex) {
        if (window.parent) {
          const iframe = window.parent.document.getElementById('tabIframe');
          const tabButtons = window.parent.document.querySelectorAll('.tab-btn');

          // 탭 인덱스에 따라 URL 지정
          let url = '';
          if (tabIndex === 0) url = 'partial-send.html';
          else if (tabIndex === 1) url = 'partial-history.html';
          else if (tabIndex === 2) url = 'partial-charge.html';

          // iframe src 변경
          if (iframe && url) {
            iframe.src = url;
          }

          // active 클래스 토글
          tabButtons.forEach(btn => {
            const btnUrl = btn.getAttribute('data-url');
            btn.classList.toggle('active', btnUrl === url);
          });
        }
      }


      // 이미지 삭제
      function fnDelSelectorFile(button) {
        const li = button.closest('li');
        if (li) {
          li.remove();

          // iframe 부모에게 높이 재조정 요청
          if (window.parent) {
            const height = document.documentElement.scrollHeight;
            window.parent.postMessage({ type: 'resize-iframe', height }, '*');
          }
        }
      }


   // 체크박스 체크 시 변경
   function initSendCheckboxToggle() {
    document.querySelectorAll('.checkbox .sendCheck').forEach(checkbox => {
      const wrapper = checkbox.closest('.checkbox');
      checkbox.addEventListener('change', () => wrapper.classList.toggle('on', checkbox.checked));
      wrapper.classList.toggle('on', checkbox.checked);
    });
  }


  </script>